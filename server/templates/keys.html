<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Key Management - Admin Panel</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-title">Admin Panel</div>
        <a href="/keys" class="sidebar-link active"><span class="icon">ðŸ”‘</span><span class="label">Keys</span></a>
        <a href="/bans" class="sidebar-link"><span class="icon">ðŸš«</span><span class="label">Bans</span></a>
        <a href="/logs" class="sidebar-link"><span class="icon">ðŸ“œ</span><span class="label">Logs</span></a>
        <div class="logout-btn">
            <a href="/logout" class="btn btn-secondary btn-sm">Logout</a>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <h1>Key Management</h1>

            <form action="/keys/create" method="post" class="row form-inline create-form">
                <select name="duration" class="form-select">
                    <option value="hour">Hour</option>
                    <option value="day">Day</option>
                    <option value="week">Week</option>
                    <option value="month">Month</option>
                    <option value="year">Year</option>
                    <option value="forever">Forever</option>
                </select>
                <button type="submit" class="btn btn-primary">Create Key</button>
            </form>

            <div class="table-wrap">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Activated At</th>
                            <th>HWID</th>
                            <th>Remaining Time</th>
                            <th>Last Used</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Keys}}
                        <tr{{if .Banned}} class="banned"{{else if .Frozen}} class="frozen"{{end}}>
                            <td>
                                {{.Key}}
                                {{if .Banned}}<span class="status-badge banned">BANNED</span>{{end}}
                                {{if .Frozen}}<span class="status-badge frozen">FROZEN</span>{{end}}
                            </td>
                            <td>{{if .ActivatedAt}}{{.ActivatedAt.Format "2006-01-02 15:04:05"}}{{else}}Not activated{{end}}</td>
                            <td>{{if .BoundHWID}}{{.BoundHWID}}{{else}}-{{end}}</td>
                            <td>
                                {{if .Frozen}}
                                    <span class="status-frozen">Frozen</span>
                                {{else if eq .Duration -1}}
                                    <span class="status-forever">Forever</span>
                                {{else if not .ActivatedAt}}
                                    <span class="status-inactive">Not activated</span>
                                {{else if .ExpiresAt}}
                                    {{$now := timeNow}}
                                    {{if $now.After .ExpiresAt}}
                                        <span class="status-expired">Expired</span>
                                    {{else}}
                                        {{$remaining := timeUntilExpiry .ExpiresAt}}
                                        <span class="status-active">{{formatDuration $remaining}}</span>
                                    {{end}}
                                {{else}}
                                    <span class="status-processing">Processing...</span>
                                {{end}}
                            </td>
                            <td>{{if .LastUsed}}{{.LastUsed.Format "2006-01-02 15:04:05"}}{{else}}Never{{end}}</td>
                            <td class="actions">
                                <div class="actions-scroll">
                                    {{if not .Banned}}
                                    <form action="/keys/action" method="post">
                                        <input type="hidden" name="key" value="{{.Key}}">
                                        <input type="hidden" name="action" value="freeze">
                                        <button type="submit" class="btn btn-dark btn-sm">{{if .Frozen}}Unfreeze{{else}}Freeze{{end}}</button>
                                    </form>

                                    <form action="/keys/action" method="post">
                                        <input type="hidden" name="key" value="{{.Key}}">
                                        <input type="hidden" name="action" value="ban">
                                        <div class="form-row">
                                            <input type="text" name="reason" placeholder="Ban reason" class="input-sm" required>
                                        </div>
                                        <button type="submit" class="btn btn-dark btn-sm">Ban</button>
                                    </form>
                                    {{end}}

                                    {{if .BoundHWID}}
                                    <form action="/keys/action" method="post">
                                        <input type="hidden" name="key" value="{{.Key}}">
                                        <input type="hidden" name="action" value="reset_hwid">
                                        <button type="submit" class="btn btn-dark btn-sm" onclick="return confirm('Reset HWID for this key?')">Reset HWID</button>
                                    </form>
                                    {{end}}

                                    {{if and .ActivatedAt (ne .Duration -1)}}
                                    <form action="/keys/action" method="post">
                                        <input type="hidden" name="key" value="{{.Key}}">
                                        <input type="hidden" name="action" value="extend">
                                        <div class="form-row">
                                            <select name="extend_duration" class="form-select" required>
                                                <option value="">Extend by...</option>
                                                <option value="hour">+1 Hour</option>
                                                <option value="day">+1 Day</option>
                                                <option value="week">+1 Week</option>
                                                <option value="month">+1 Month</option>
                                                <option value="year">+1 Year</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-dark btn-sm">Extend</button>
                                    </form>
                                    {{end}}

                                    <form action="/keys/action" method="post">
                                        <input type="hidden" name="key" value="{{.Key}}">
                                        <input type="hidden" name="action" value="delete">
                                        <button type="submit" class="btn btn-dark btn-sm" onclick="return confirm('Delete this key permanently?')">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {{else}}
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--muted);">No keys found</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>